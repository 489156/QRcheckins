<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ì¶œì„ì²´í¬ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</title>
  <style>
    body { font-family: 'Malgun Gothic', sans-serif; margin:0; padding:20px; background:#f5f5f5; }
    .header { background: linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:#fff; padding:20px; border-radius:10px; text-align:center; }
    .header h1 { margin:0; font-size:28px; }
    .qr-urls, .controls, .stats, .table-container { background:#fff; padding:20px; border-radius:10px; box-shadow:0 2px 5px rgba(0,0,0,0.1); margin-bottom:20px; }
    .qr-urls h3 { margin-top:0; color:#333; }
    .url-item { background:#f8f9fa; border:1px solid #dee2e6; padding:15px; margin-bottom:10px; border-radius:5px; }
    .url-label { font-weight:bold; color:#495057; margin-bottom:5px; }
    .url-link { font-family:monospace; background:#fff; padding:8px; border:1px solid #ced4da; border-radius:3px; word-break:break-all; font-size:12px; color:#007bff; }
    .controls .control-group { display:inline-block; margin-right:20px; }
    .controls .control-group label { font-weight:bold; margin-right:10px; }
    .controls button { padding:8px 15px; border:1px solid #ddd; border-radius:5px; font-size:14px; color:#fff; background:#667eea; cursor:pointer; margin-left:10px; }
    .controls button:hover { background:#5a67d8; }
    .stats .stat-item { display:inline-block; margin-right:30px; text-align:center; }
    .stat-number { font-size:24px; font-weight:bold; color:#667eea; }
    .stat-label { font-size:14px; color:#666; }
    table { width:100%; border-collapse:collapse; font-size:14px; }
    th { background:#667eea; color:#fff; padding:15px 8px; text-align:center; }
    td { padding:12px 8px; border-bottom:1px solid #eee; text-align:center; }
    tr:nth-child(even) { background:#f9f9f9; }
    tr:hover { background:#f0f0f0; }
    .name-col { font-weight:bold; text-align:left; background:#f8f9fa; }
    .phone-col { font-family:monospace; color:#666; }
    .present { color:#28a745; font-weight:bold; font-size:12px; }
    .absent { color:#dc3545; font-weight:bold; }
    .export-section .refresh-info { background:#e3f2fd; border:1px solid #bbdefb; padding:10px; border-radius:5px; font-size:12px; color:#1976d2; }
    @media(max-width:768px){
      .controls .control-group { display:block; margin-bottom:15px; }
      table, th, td { font-size:12px; padding:8px 4px; }
      .url-link { font-size:10px; }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>ğŸ“Š ì¶œì„ì²´í¬ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h1>
    <div id="lastUpdate"></div>
  </div>

  <div class="qr-urls">
    <h3>ğŸ¯ QR ì½”ë“œ ìƒì„±ìš© URL ëª©ë¡</h3>
    <div class="url-item">
      <div class="url-label">1ì¼ì°¨ ì˜¤ì „ (09:00)</div>
      <div class="url-link" id="url1"></div>
    </div>
    <div class="url-item">
      <div class="url-label">1ì¼ì°¨ ì˜¤í›„ (17:30)</div>
      <div class="url-link" id="url2"></div>
    </div>
    <div class="url-item">
      <div class="url-label">2ì¼ì°¨ ì˜¤ì „ (09:00)</div>
      <div class="url-link" id="url3"></div>
    </div>
    <div class="url-item">
      <div class="url-label">2ì¼ì°¨ ì˜¤í›„ (17:30)</div>
      <div class="url-link" id="url4"></div>
    </div>
  </div>

  <div class="controls">
    <div class="control-group">
      <button onclick="refreshData()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
      <button onclick="exportData()">ğŸ“Š CSV ë‚´ë³´ë‚´ê¸°</button>
      <button onclick="clearData()" style="background:#dc3545">ğŸ—‘ï¸ ë°ì´í„° ì´ˆê¸°í™”</button>
    </div>
  </div>

  <div class="stats">
    <div class="stat-item">
      <div class="stat-number" id="totalStudents">0</div>
      <div class="stat-label">ì´ êµìœ¡ìƒ</div>
    </div>
    <div class="stat-item">
      <div class="stat-number" id="totalAttendance">0</div>
      <div class="stat-label">ì „ì²´ ì¶œì„ ê±´ìˆ˜</div>
    </div>
    <div class="stat-item">
      <div class="stat-number" id="avgAttendanceRate">0%</div>
      <div class="stat-label">í‰ê·  ì¶œì„ë¥ </div>
    </div>
  </div>

  <div class="table-container">
    <table id="attendanceTable">
      <thead>
        <tr>
          <th>ì´ë¦„</th>
          <th>íœ´ëŒ€ì „í™”ë²ˆí˜¸</th>
          <th>1ì¼ì°¨ ì˜¤ì „</th>
          <th>1ì¼ì°¨ ì˜¤í›„</th>
          <th>2ì¼ì°¨ ì˜¤ì „</th>
          <th>2ì¼ì°¨ ì˜¤í›„</th>
          <th>ì¶œì„ë¥ </th>
        </tr>
      </thead>
      <tbody id="attendanceTableBody"></tbody>
    </table>
  </div>

  <div class="export-section">
    <div class="refresh-info">
      ğŸ’¡ ì‹¤ì‹œê°„ ë°ì´í„° í™•ì¸ì„ ìœ„í•´ ì •ê¸°ì ìœ¼ë¡œ ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ì„ í´ë¦­í•´ì£¼ì„¸ìš”.<br>
      QR ì½”ë“œëŠ” ìœ„ì˜ URL ëª©ë¡ì„ ì´ìš©í•˜ì—¬ ê°ê° ìƒì„±í•˜ì„¸ìš”.
    </div>
  </div>

  <script>
    const studentList = {
            '01082123698': 'ì‹ ë™í•˜',
            '01048842236': 'ì´ì„±ì£¼',
            '01044110409': 'í•˜ë‚˜í˜„',
            '01093763225': 'ê¹€ì¬í•˜',
            '01091573109': 'í•œìŠ¹í˜¸',
            '01073591226': 'ë¬¸ì˜ì£¼',
            '01022219219': 'ê¹€ì¬ì˜',
            '01048749245': 'ë°•ì„±í˜¸',
            '01094796810': 'ê°•í˜„ì •',
            '01027754561': 'ì–‘ë¬¸ì¼',
            '01034341343': 'ë°•ë„ì—°',
            '01072230475': 'ê¹€í˜œë¦¬',
            '01040546272': 'ê¹€ê¸°íƒœ',
            '01026529008': 'í™©í˜„ì§„',
            '01038388015': 'ê¶Œìœ¤ê²½',
            '01025532652': 'ìœ¤ì •í›ˆ',
            '01083685635': 'ì†ì„í™',
            '01029127176': 'ì—„ê¸°ì² ',
            '01033074257': 'ì†¡ìš©ì„',
            '01028798460': 'ì˜¤ì² ì§„',
            '01072774457': 'ìœ ì˜ìš±',
            '01045666411': 'ì´ìŠ¹í¬',
            '01043798508': 'ì´ë³‘ê¸¸',
            '01088741172': 'ê¹€í¬ì˜',
            '01062644832': 'ì†ì˜ì§€',
            '01072443789': 'ì˜ˆì„±ë¯¼',
            '01067899391': 'ë¬¸ì§€ìˆ˜',
            '01082183288': 'ì¡°í˜œì •',
            '01066546059': 'ê³ ì¬ìœ¤',
            '01091676897': 'ì„±ìƒí›ˆ',
            '01092784335': 'ì´ë¯¸ê²½',
            '01090087476': 'ê¹€ê²½ë€',
            '01030634395': 'ì¡°ê·œíƒœ',
            '01024219154': 'ìµœê²½í›ˆ',
            '01040009967': 'ì‹ í˜„ì •',
            '01090039373': 'ê¹€ì¢…í•„',
            '01047698831': 'ì¥ì›êµ¬',
            '01087392594': 'ì´í˜„ì£¼'
    };
    const eventNames = {
      'day1_morning':'1ì¼ì°¨ ì˜¤ì „','day1_evening':'1ì¼ì°¨ ì˜¤í›„',
      'day2_morning':'2ì¼ì°¨ ì˜¤ì „','day2_evening':'2ì¼ì°¨ ì˜¤í›„'
    };

    function loadAttendanceData(){
      return JSON.parse(localStorage.getItem('attendanceData')||'{}');
    }

    function initializeURLs(){
      const base = window.location.origin + window.location.pathname.replace('admin_dashboard.html','');
      document.getElementById('url1').textContent = base+'?event=day1_morning';
      document.getElementById('url2').textContent = base+'?event=day1_evening';
      document.getElementById('url3').textContent = base+'?event=day2_morning';
      document.getElementById('url4').textContent = base+'?event=day2_evening';
    }

    function updateDashboard(){
      const data = loadAttendanceData();
      const tbody = document.getElementById('attendanceTableBody');
      tbody.innerHTML = '';
      let totalStudents = Object.keys(studentList).length, totalCount=0, rateSum=0;
      Object.entries(studentList).forEach(([phone,name])=>{
        const row = document.createElement('tr');
        let attended=0;
        // ì´ë¦„, ì „í™”
        const tdName=document.createElement('td'); tdName.textContent=name; tdName.className='name-col'; row.appendChild(tdName);
        const tdPhone=document.createElement('td'); tdPhone.textContent=phone.replace(/(\d{3})(\d{4})(\d{4})/,'$1-$2-$3'); tdPhone.className='phone-col'; row.appendChild(tdPhone);
        // ì´ë²¤íŠ¸ë³„
        ['day1_morning','day1_evening','day2_morning','day2_evening'].forEach(evt=>{
          const td=document.createElement('td');
          const rec = data[phone]?.events?.[evt];
          if(rec && typeof rec==='object' && rec.timestamp){
            const timeOnly = rec.timestamp.split(', ')[1]||'';
            td.innerHTML=`<div class="present">ì¶œì„</div><div style="font-size:10px;color:#666">${timeOnly}</div>`;
            attended++; totalCount++;
          } else {
            td.textContent='ë¯¸ì¶œì„'; td.className='absent';
          }
          row.appendChild(td);
        });
        const rate=Math.round(attended/4*100);
        rateSum+=rate;
        const tdRate=document.createElement('td');
        tdRate.textContent=rate+'%';
        tdRate.style.color=rate>=75?'#28a745':rate>=50?'#ffc107':'#dc3545';
        tdRate.style.fontWeight='bold';
        row.appendChild(tdRate);

        tbody.appendChild(row);
      });
      document.getElementById('totalStudents').textContent=totalStudents;
      document.getElementById('totalAttendance').textContent=totalCount;
      document.getElementById('avgAttendanceRate').textContent= totalStudents?Math.round(rateSum/totalStudents)+'%':'0%';
      document.getElementById('lastUpdate').textContent='ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: '+new Date().toLocaleString('ko-KR');
    }

    function refreshData(){ updateDashboard(); alert('ë°ì´í„°ê°€ ìƒˆë¡œê³ ì¹¨ë˜ì—ˆìŠµë‹ˆë‹¤.'); }
    function exportData(){
      const data=loadAttendanceData();
      let csv='Name,Phone,Day1_Morning,Day1_Evening,Day2_Morning,Day2_Evening,Rate\n';
      Object.entries(studentList).forEach(([p,n])=>{
        const recs=data[p]?.events||{};
        const parts=['day1_morning','day1_evening','day2_morning','day2_evening'].map(evt=>
          recs[evt]?.timestamp||'ë¯¸ì¶œì„'
        );
        const cnt=parts.filter(v=>v!=='ë¯¸ì¶œì„').length;
        csv+=`"${n}","${p.replace(/(\d{3})(\d{4})(\d{4})/,'$1-$2-$3')}",${parts.join(',')},${Math.round(cnt/4*100)}%\n`;
      });
      const blob=new Blob([csv],{type:'text/csv'}), link=document.createElement('a');
      link.href=URL.createObjectURL(blob);
      link.download=`attendance_${new Date().toISOString().split('T')[0]}.csv`;
      document.body.appendChild(link); link.click(); document.body.removeChild(link);
    }
    function clearData(){
      if(confirm('ëª¨ë“  ì¶œì„ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')){
        localStorage.removeItem('attendanceData'); updateDashboard(); alert('ì‚­ì œ ì™„ë£Œ');
      }
    }

    document.addEventListener('DOMContentLoaded', function(){
      initializeURLs();
      updateDashboard();
      setInterval(updateDashboard,300000);
    });
  </script>
</body>
</html>
