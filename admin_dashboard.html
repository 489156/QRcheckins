<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¶œì„ì²´í¬ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</title>
    <style>
        body {
            font-family: 'Malgun Gothic', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        .header h1 {
            margin: 0;
            font-size: 28px;
        }

        .qr-urls {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .qr-urls h3 {
            margin-top: 0;
            color: #333;
        }

        .url-item {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 5px;
        }

        .url-label {
            font-weight: bold;
            color: #495057;
            margin-bottom: 5px;
        }

        .url-link {
            font-family: monospace;
            background: white;
            padding: 8px;
            border: 1px solid #ced4da;
            border-radius: 3px;
            word-break: break-all;
            font-size: 12px;
            color: #007bff;
        }

        .controls {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .control-group {
            display: inline-block;
            margin-right: 20px;
            margin-bottom: 10px;
        }

        .control-group label {
            font-weight: bold;
            margin-right: 10px;
        }

        select, button {
            padding: 8px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        button {
            background: #667eea;
            color: white;
            border: none;
            cursor: pointer;
            margin-left: 10px;
        }

        button:hover {
            background: #5a67d8;
        }

        .stats {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .stat-item {
            display: inline-block;
            margin-right: 30px;
            text-align: center;
        }

        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            font-size: 14px;
            color: #666;
        }

        .table-container {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        th {
            background: #667eea;
            color: white;
            padding: 15px 8px;
            text-align: center;
            font-weight: bold;
        }

        td {
            padding: 12px 8px;
            border-bottom: 1px solid #eee;
            text-align: center;
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        tr:hover {
            background-color: #f0f0f0;
        }

        .name-col {
            font-weight: bold;
            text-align: left;
            background-color: #f8f9fa;
        }

        .phone-col {
            font-family: monospace;
            color: #666;
        }

        .present {
            color: #28a745;
            font-weight: bold;
            font-size: 12px;
        }

        .absent {
            color: #dc3545;
            font-weight: bold;
        }

        .export-section {
            margin-top: 20px;
            text-align: center;
        }

        .refresh-info {
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 12px;
            color: #1976d2;
        }

        @media (max-width: 768px) {
            .controls {
                text-align: center;
            }

            .control-group {
                display: block;
                margin-bottom: 15px;
            }

            table {
                font-size: 12px;
            }

            th, td {
                padding: 8px 4px;
            }

            .url-link {
                font-size: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ“Š ì¶œì„ì²´í¬ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h1>
        <div id="lastUpdate"></div>
    </div>

    <div class="qr-urls">
        <h3>ğŸ¯ QR ì½”ë“œ ìƒì„±ìš© URL ëª©ë¡</h3>
        <p>ê° ì´ë²¤íŠ¸ë³„ë¡œ ì•„ë˜ URLì„ QR ì½”ë“œë¡œ ìƒì„±í•˜ì—¬ ì¸ì‡„í•˜ì„¸ìš”:</p>

        <div class="url-item">
            <div class="url-label">1ì¼ì°¨ ì˜¤ì „ (09:00)</div>
            <div class="url-link" id="url1"></div>
        </div>

        <div class="url-item">
            <div class="url-label">1ì¼ì°¨ ì˜¤í›„ (17:30)</div>
            <div class="url-link" id="url2"></div>
        </div>

        <div class="url-item">
            <div class="url-label">2ì¼ì°¨ ì˜¤ì „ (09:00)</div>
            <div class="url-link" id="url3"></div>
        </div>

        <div class="url-item">
            <div class="url-label">2ì¼ì°¨ ì˜¤í›„ (17:30)</div>
            <div class="url-link" id="url4"></div>
        </div>
    </div>

    <div class="controls">
        <div class="control-group">
            <button onclick="refreshData()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
            <button onclick="exportData()">ğŸ“Š CSV ë‚´ë³´ë‚´ê¸°</button>
            <button onclick="clearData()" style="background: #dc3545;">ğŸ—‘ï¸ ë°ì´í„° ì´ˆê¸°í™”</button>
        </div>
    </div>

    <div class="stats">
        <div class="stat-item">
            <div class="stat-number" id="totalStudents">0</div>
            <div class="stat-label">ì´ êµìœ¡ìƒ</div>
        </div>
        <div class="stat-item">
            <div class="stat-number" id="totalAttendance">0</div>
            <div class="stat-label">ì „ì²´ ì¶œì„ ê±´ìˆ˜</div>
        </div>
        <div class="stat-item">
            <div class="stat-number" id="avgAttendanceRate">0%</div>
            <div class="stat-label">í‰ê·  ì¶œì„ë¥ </div>
        </div>
    </div>

    <div class="table-container">
        <table id="attendanceTable">
            <thead>
                <tr>
                    <th>ì´ë¦„</th>
                    <th>íœ´ëŒ€ì „í™”ë²ˆí˜¸</th>
                    <th>1ì¼ì°¨ ì˜¤ì „</th>
                    <th>1ì¼ì°¨ ì˜¤í›„</th>
                    <th>2ì¼ì°¨ ì˜¤ì „</th>
                    <th>2ì¼ì°¨ ì˜¤í›„</th>
                    <th>ì¶œì„ë¥ </th>
                </tr>
            </thead>
            <tbody id="attendanceTableBody">
            </tbody>
        </table>
    </div>

    <div class="export-section">
        <div class="refresh-info">
            ğŸ’¡ ì‹¤ì‹œê°„ ë°ì´í„° í™•ì¸ì„ ìœ„í•´ ì •ê¸°ì ìœ¼ë¡œ ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ì„ í´ë¦­í•´ì£¼ì„¸ìš”.<br>
            QR ì½”ë“œëŠ” ìœ„ì˜ URL ëª©ë¡ì„ ì´ìš©í•˜ì—¬ ê°ê° ìƒì„±í•˜ì„¸ìš”.
        </div>
    </div>

    <script>
        // êµìœ¡ìƒ ëª…ë‹¨ (ì‹¤ì œ ì‚¬ìš©ì‹œì—ëŠ” ì´ ë¶€ë¶„ì„ ìˆ˜ì •í•˜ì„¸ìš”)
        const studentList = {
            '01082123698': 'ì‹ ë™í•˜',
            '01048842236': 'ì´ì„±ì£¼',
            '01044110409': 'í•˜ë‚˜í˜„',
            '01093763225': 'ê¹€ì¬í•˜',
            '01091573109': 'í•œìŠ¹í˜¸',
            '01073591226': 'ë¬¸ì˜ì£¼',
            '01022219219': 'ê¹€ì¬ì˜',
            '01048749245': 'ë°•ì„±í˜¸',
            '01094796810': 'ê°•í˜„ì •',
            '01027754561': 'ì–‘ë¬¸ì¼',
            '01034341343': 'ë°•ë„ì—°',
            '01072230475': 'ê¹€í˜œë¦¬',
            '01040546272': 'ê¹€ê¸°íƒœ',
            '01026529008': 'í™©í˜„ì§„',
            '01038388015': 'ê¶Œìœ¤ê²½',
            '01025532652': 'ìœ¤ì •í›ˆ',
            '01083685635': 'ì†ì„í™',
            '01029127176': 'ì—„ê¸°ì² ',
            '01033074257': 'ì†¡ìš©ì„',
            '01028798460': 'ì˜¤ì² ì§„',
            '01072774457': 'ìœ ì˜ìš±',
            '01045666411': 'ì´ìŠ¹í¬',
            '01043798508': 'ì´ë³‘ê¸¸',
            '01088741172': 'ê¹€í¬ì˜',
            '01062644832': 'ì†ì˜ì§€',
            '01072443789': 'ì˜ˆì„±ë¯¼',
            '01067899391': 'ë¬¸ì§€ìˆ˜',
            '01082183288': 'ì¡°í˜œì •',
            '01066546059': 'ê³ ì¬ìœ¤',
            '01091676897': 'ì„±ìƒí›ˆ',
            '01092784335': 'ì´ë¯¸ê²½',
            '01090087476': 'ê¹€ê²½ë€',
            '01030634395': 'ì¡°ê·œíƒœ',
            '01024219154': 'ìµœê²½í›ˆ',
            '01040009967': 'ì‹ í˜„ì •',
            '01090039373': 'ê¹€ì¢…í•„',
            '01047698831': 'ì¥ì›êµ¬',
            '01087392594': 'ì´í˜„ì£¼'
        };

        const eventNames = {
            'day1_morning': '1ì¼ì°¨ ì˜¤ì „',
            'day1_evening': '1ì¼ì°¨ ì˜¤í›„',
            'day2_morning': '2ì¼ì°¨ ì˜¤ì „',
            'day2_evening': '2ì¼ì°¨ ì˜¤í›„'
        };

        function loadAttendanceData() {
            return JSON.parse(localStorage.getItem('attendanceData') || '{}');
        }

        function initializeURLs() {
            const baseURL = window.location.origin + window.location.pathname.replace('admin_dashboard.html', '');

            document.getElementById('url1').textContent = baseURL + '?event=day1_morning';
            document.getElementById('url2').textContent = baseURL + '?event=day1_evening';
            document.getElementById('url3').textContent = baseURL + '?event=day2_morning';
            document.getElementById('url4').textContent = baseURL + '?event=day2_evening';
        }

        function updateDashboard() {
            const attendanceData = loadAttendanceData();
            const tableBody = document.getElementById('attendanceTableBody');

            tableBody.innerHTML = '';

            let totalStudents = Object.keys(studentList).length;
            let totalAttendanceCount = 0;
            let totalAttendanceSum = 0;

            // ê° êµìœ¡ìƒë³„ë¡œ í–‰ ìƒì„±
            for (const [phone, name] of Object.entries(studentList)) {
                const row = document.createElement('tr');

                // ì´ë¦„
                const nameCell = document.createElement('td');
                nameCell.textContent = name;
                nameCell.className = 'name-col';
                row.appendChild(nameCell);

                // ì „í™”ë²ˆí˜¸
                const phoneCell = document.createElement('td');
                phoneCell.textContent = phone.replace(/(\d{3})(\d{4})(\d{4})/, '$1-$2-$3');
                phoneCell.className = 'phone-col';
                row.appendChild(phoneCell);

                // ê° ì´ë²¤íŠ¸ë³„ ì¶œì„ ìƒíƒœ
                const events = ['day1_morning', 'day1_evening', 'day2_morning', 'day2_evening'];
                let attendedEvents = 0;

                events.forEach(event => {
                    const cell = document.createElement('td');
                    const studentData = attendanceData[phone];

                    if (studentData && studentData.events[event]) {
                        const timestamp = studentData.events[event];
                        const timeOnly = timestamp.split(' ')[1]; // ì‹œê°„ ë¶€ë¶„ë§Œ ì¶”ì¶œ
                        cell.innerHTML = `<div class="present">ì¶œì„</div><div style="font-size: 10px; color: #666;">${timeOnly}</div>`;
                        attendedEvents++;
                        totalAttendanceCount++;
                    } else {
                        cell.textContent = 'ë¯¸ì¶œì„';
                        cell.className = 'absent';
                    }

                    row.appendChild(cell);
                });

                // ê°œì¸ ì¶œì„ë¥ 
                const rateCell = document.createElement('td');
                const rate = Math.round((attendedEvents / 4) * 100);
                rateCell.textContent = rate + '%';
                rateCell.style.fontWeight = 'bold';
                rateCell.style.color = rate >= 75 ? '#28a745' : rate >= 50 ? '#ffc107' : '#dc3545';
                row.appendChild(rateCell);

                totalAttendanceSum += rate;
                tableBody.appendChild(row);
            }

            // í†µê³„ ì—…ë°ì´íŠ¸
            document.getElementById('totalStudents').textContent = totalStudents;
            document.getElementById('totalAttendance').textContent = totalAttendanceCount;
            document.getElementById('avgAttendanceRate').textContent = 
                totalStudents > 0 ? Math.round(totalAttendanceSum / totalStudents) + '%' : '0%';

            // ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„
            const now = new Date();
            document.getElementById('lastUpdate').textContent = 
                'ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ' + now.toLocaleString('ko-KR');
        }

        function refreshData() {
            updateDashboard();
            alert('ë°ì´í„°ê°€ ìƒˆë¡œê³ ì¹¨ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        function exportData() {
            const attendanceData = loadAttendanceData();

            // CSV í—¤ë”
            let csv = 'Name,Phone,Day1_Morning,Day1_Evening,Day2_Morning,Day2_Evening,Attendance_Rate\n';

            // ê° êµìœ¡ìƒ ë°ì´í„°
            for (const [phone, name] of Object.entries(studentList)) {
                const studentData = attendanceData[phone];
                const events = ['day1_morning', 'day1_evening', 'day2_morning', 'day2_evening'];

                let attendedCount = 0;
                let eventData = [];

                events.forEach(event => {
                    if (studentData && studentData.events[event]) {
                        eventData.push(`"${studentData.events[event]}"`);
                        attendedCount++;
                    } else {
                        eventData.push('ë¯¸ì¶œì„');
                    }
                });

                const rate = Math.round((attendedCount / 4) * 100);
                const phoneFormatted = phone.replace(/(\d{3})(\d{4})(\d{4})/, '$1-$2-$3');

                csv += `"${name}","${phoneFormatted}",${eventData.join(',')},${rate}%\n`;
            }

            // CSV íŒŒì¼ ë‹¤ìš´ë¡œë“œ
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `attendance_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function clearData() {
            if (confirm('ì •ë§ë¡œ ëª¨ë“  ì¶œì„ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                localStorage.removeItem('attendanceData');
                updateDashboard();
                alert('ëª¨ë“  ì¶œì„ ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        // í˜ì´ì§€ ë¡œë“œì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            initializeURLs();
            updateDashboard();

            // 5ë¶„ë§ˆë‹¤ ìë™ ìƒˆë¡œê³ ì¹¨
            setInterval(updateDashboard, 300000);
        });
    </script>
</body>
</html>